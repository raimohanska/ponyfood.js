(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb=[].slice,fb={}.hasOwnProperty,gb=function(a,b){function c(){this.constructor=a}for(var d in b)fb.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hb=function(a,b){return function(){return a.apply(b,arguments)}};n={toString:function(){return"Ponyfood"}},n.version="0.7.7",n.fromBinder=function(a,b){return null==b&&(b=cb.id),new i(y(n,"fromBinder",a,b),function(c){var d;return d=a(function(){var a,e,f,g,i,j;for(a=1<=arguments.length?eb.call(arguments,0):[],g=b.apply(null,a),F(g)&&cb.last(g)instanceof h||(g=[g]),f=n.more,i=0,j=g.length;j>i;i++)if(e=g[i],f=c(e=X(e)),f===n.noMore||e.isEnd())return null!=d?d():n.scheduler.setTimeout(function(){return d()},0),f;return f})})},n.$={asEventStream:function(a,b,c){var d;return H(b)&&(d=[b,null],c=d[0],b=d[1]),ab(this,"asEventStream",a,n.fromBinder(function(c){return function(d){return c.on(a,b,d),function(){return c.off(a,b,d)}}}(this),c))}},null!=(db="undefined"!=typeof jQuery&&null!==jQuery?jQuery:"undefined"!=typeof Zepto&&null!==Zepto?Zepto:null)&&(db.fn.asEventStream=n.$.asEventStream),n.fromEventTarget=function(a,b,c){var d,e,f,g,h,i;return d=null!=(f=a.addEventListener)?f:null!=(g=a.addListener)?g:a.bind,e=null!=(h=a.removeEventListener)?h:null!=(i=a.removeListener)?i:a.unbind,ab(n,"fromEventTarget",a,b,n.fromBinder(function(c){return d.call(a,b,c),function(){return e.call(a,b,c)}},c))},n.fromPromise=function(a,b){return ab(n,"fromPromise",a,n.fromBinder(function(c){return a.then(c,function(a){return c(new g(a))}),function(){return b?"function"==typeof a.abort?a.abort():void 0:void 0}},function(a){return[a,z()]}))},n.noMore=["<no-more>"],n.more=["<more>"],n.later=function(a,b){return ab(n,"later",a,b,n.sequentially(a,[b]))},n.sequentially=function(a,b){var c;return c=0,ab(n,"sequentially",a,b,n.fromPoll(a,function(){var a;return a=b[c++],c<b.length?a:c===b.length?[a,z()]:z()}))},n.repeatedly=function(a,b){var c;return c=0,ab(n,"repeatedly",a,b,n.fromPoll(a,function(){return b[c++%b.length]}))},n.spy=function(a){return V.push(a)},V=[],U=function(a){var b,c,d,e;if(V.length&&!U.running)try{for(U.running=!0,e=[],c=0,d=V.length;d>c;c++)b=V[c],e.push(b(a));return e}finally{delete U.running}},bb=function(a){return function(){var b,c,d,e;return d=arguments[0],b=2<=arguments.length?eb.call(arguments,1):[],"object"==typeof d&&b.length&&(c=d,e=b[0],d=function(){return c[e].apply(c,arguments)},b=b.slice(1)),a.apply(null,[d].concat(eb.call(b)))}},K=function(a,b){return bb(function(){var c,d,e;return d=arguments[0],c=2<=arguments.length?eb.call(arguments,1):[],e=S(b,[function(a,b){return d.apply(null,eb.call(a).concat([b]))}]),ab.apply(null,[n,a,d].concat(eb.call(c),[n.combineAsArray(c).flatMap(e)]))})},n.fromCallback=K("fromCallback",function(){var a,b;return b=arguments[0],a=2<=arguments.length?eb.call(arguments,1):[],n.fromBinder(function(c){return L(b,a)(c),R},function(a){return[a,z()]})}),n.fromNodeCallback=K("fromNodeCallback",function(){var a,b;return b=arguments[0],a=2<=arguments.length?eb.call(arguments,1):[],n.fromBinder(function(c){return L(b,a)(c),R},function(a,b){return a?[new g(a),z()]:[b,z()]})}),n.fromPoll=function(a,b){return ab(n,"fromPoll",a,b,n.fromBinder(function(b){var c;return c=n.scheduler.setInterval(b,a),function(){return n.scheduler.clearInterval(c)}},b))},n.interval=function(a,b){return null==b&&(b={}),ab(n,"interval",a,b,n.fromPoll(a,function(){return Q(b)}))},n.constant=function(a){return new o(y(n,"constant",a),function(b){return b(E(a)),b(z()),R})},n.never=function(){return ab(n,"never",n.fromArray([]))},n.once=function(a){return ab(n,"once",a,n.fromArray([a]))},n.fromArray=function(a){return a=u(a),new i(y(n,"fromArray",a),function(b){var c,d;return d=!1,c=function(){var e,f;return cb.empty(a)?b(z()):(f=a.splice(0,1)[0],e=b(X(f)),e===n.noMore||d?void 0:c())},c(),function(){return d=!0}})},n.mergeAll=function(){var a;return a=1<=arguments.length?eb.call(arguments,0):[],F(a[0])&&(a=a[0]),ab.apply(null,[n,"mergeAll"].concat(eb.call(a),[cb.fold(a,n.never(),function(a,b){return a.merge(b)})]))},n.zipAsArray=function(){var a;return a=1<=arguments.length?eb.call(arguments,0):[],F(a[0])&&(a=a[0]),ab.apply(null,[n,"zipAsArray"].concat(eb.call(a),[n.zipWith(a,function(){var a;return a=1<=arguments.length?eb.call(arguments,0):[]})]))},n.zipWith=function(){var a,b,c;return a=arguments[0],b=2<=arguments.length?eb.call(arguments,1):[],H(a)||(c=[a,b[0]],b=c[0],a=c[1]),b=cb.map(function(a){return a.toEventStream()},b),ab.apply(null,[n,"zipWith",a].concat(eb.call(b),[n.when(b,a)]))},n.groupSimultaneous=function(){var b,c,d;return d=1<=arguments.length?eb.call(arguments,0):[],1===d.length&&F(d[0])&&(d=d[0]),c=function(){var c,e,f;for(f=[],c=0,e=d.length;e>c;c++)b=d[c],f.push(new a(b));return f}(),ab.apply(null,[n,"groupSimultaneous"].concat(eb.call(d),[n.when(c,function(){var a;return a=1<=arguments.length?eb.call(arguments,0):[]})]))},n.combineAsArray=function(){var a,b,c,d,e,f,g;for(e=1<=arguments.length?eb.call(arguments,0):[],1===e.length&&F(e[0])&&(e=e[0]),a=f=0,g=e.length;g>f;a=++f)d=e[a],I(d)||(e[a]=n.constant(d));return e.length?(c=function(){var a,c,d;for(d=[],a=0,c=e.length;c>a;a++)b=e[a],d.push(new r(b,!0,!1,b.subscribeInternal));return d}(),ab.apply(null,[n,"combineAsArray"].concat(eb.call(e),[n.when(c,function(){var a;return a=1<=arguments.length?eb.call(arguments,0):[]}).toProperty()]))):n.constant([])},n.onValues=function(){var a,b,c;return b=2<=arguments.length?eb.call(arguments,0,c=arguments.length-1):(c=0,[]),a=arguments[c++],n.combineAsArray(b).onValues(a)},n.combineWith=function(){var a,b;return a=arguments[0],b=2<=arguments.length?eb.call(arguments,1):[],ab.apply(null,[n,"combineWith",a].concat(eb.call(b),[n.combineAsArray(b).map(function(b){return a.apply(null,b)})]))},n.combineTemplate=function(a){var b,c,d,e,f,g,h,i,j,k;return h=[],k=[],g=function(a){return a[a.length-1]},j=function(a,b,c){return g(a)[b]=c},b=function(a,b){return function(c,d){return j(c,a,d[b])}},f=function(a,b){return function(c){return j(c,a,b)}},i=function(a){return F(a)?[]:{}},d=function(a,c){var d,g;return I(c)?(k.push(c),h.push(b(a,k.length-1))):c!==Object(c)||"function"==typeof c||c instanceof RegExp||c instanceof Date?h.push(f(a,c)):(g=function(a){return function(b){var d;return d=i(c),j(b,a,d),b.push(d)}},d=function(a){return a.pop()},h.push(g(a)),e(c),h.push(d))},e=function(a){return cb.each(a,d)},e(a),c=function(b){var c,d,e,f,g;for(e=i(a),c=[e],f=0,g=h.length;g>f;f++)(d=h[f])(c,b);return e},ab(n,"combineTemplate",a,n.combineAsArray(k).map(c))},A=0,h=function(){function a(){this.id=++A}return a.prototype.isEvent=function(){return!0},a.prototype.isEnd=function(){return!1},a.prototype.isInitial=function(){return!1},a.prototype.isNext=function(){return!1},a.prototype.isError=function(){return!1},a.prototype.hasValue=function(){return!1},a.prototype.filter=function(){return!0},a.prototype.inspect=function(){return this.toString()},a}(),k=function(a){function b(a){b.__super__.constructor.call(this),this.value=H(a)?cb.cached(a):cb.always(a)}return gb(b,a),b.prototype.isNext=function(){return!0},b.prototype.hasValue=function(){return!0},b.prototype.fmap=function(a){return this.apply(function(b){return function(){return a(b.value())}}(this))},b.prototype.apply=function(a){return new b(a)},b.prototype.filter=function(a){return a(this.value())},b.prototype.toString=function(){return cb.toString(this.value())},b}(h),j=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return gb(b,a),b.prototype.isInitial=function(){return!0},b.prototype.isNext=function(){return!1},b.prototype.apply=function(a){return new b(a)},b.prototype.toNext=function(){return new k(this.value)},b}(k),f=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return gb(b,a),b.prototype.isEnd=function(){return!0},b.prototype.fmap=function(){return this},b.prototype.apply=function(){return this},b.prototype.toString=function(){return"<end>"},b}(h),g=function(a){function b(a){this.error=a}return gb(b,a),b.prototype.isError=function(){return!0},b.prototype.fmap=function(){return this},b.prototype.apply=function(){return this},b.prototype.toString=function(){return"<error> "+cb.toString(this.error)},b}(h),D=0,m=function(){function a(a){this.combine=hb(this.combine,this),this.flatMapLatest=hb(this.flatMapLatest,this),this.fold=hb(this.fold,this),this.scan=hb(this.scan,this),this.id=++D,this.assign=this.onValue,ab(a,this)}return a.prototype.onValue=function(){var a;return a=M(arguments),this.subscribe(function(b){return b.hasValue()?a(b.value()):void 0})},a.prototype.onValues=function(a){return this.onValue(function(b){return a.apply(null,b)})},a.prototype.onError=function(){var a;return a=M(arguments),this.subscribe(function(b){return b.isError()?a(b.error):void 0})},a.prototype.onEnd=function(){var a;return a=M(arguments),this.subscribe(function(b){return b.isEnd()?a():void 0})},a.prototype.errors=function(){return ab(this,"errors",this.filter(function(){return!1}))},a.prototype.filter=function(){var a,b;return b=arguments[0],a=2<=arguments.length?eb.call(arguments,1):[],x(this,b,a,function(a){return ab(this,"filter",a,this.withHandler(function(b){return b.filter(a)?this.push(b):n.more}))})},a.prototype.takeWhile=function(){var a,b;return b=arguments[0],a=2<=arguments.length?eb.call(arguments,1):[],x(this,b,a,function(a){return ab(this,"takeWhile",a,this.withHandler(function(b){return b.filter(a)?this.push(b):(this.push(z()),n.noMore)}))})},a.prototype.endOnError=function(){var a,b;return b=arguments[0],a=2<=arguments.length?eb.call(arguments,1):[],null==b&&(b=!0),x(this,b,a,function(a){return ab(this,"endOnError",this.withHandler(function(b){return b.isError()&&a(b.error)?(this.push(b),this.push(z())):this.push(b)}))})},a.prototype.take=function(a){return 0>=a?n.never():ab(this,"take",a,this.withHandler(function(b){return b.hasValue()?(a--,a>0?this.push(b):(0===a&&this.push(b),this.push(z()),n.noMore)):this.push(b)}))},a.prototype.map=function(){var a,b;return b=arguments[0],a=2<=arguments.length?eb.call(arguments,1):[],b instanceof o?b.sampledBy(this,C):x(this,b,a,function(a){return ab(this,"map",a,this.withHandler(function(b){return this.push(b.fmap(a))}))})},a.prototype.mapError=function(){var a;return a=M(arguments),ab(this,"mapError",a,this.withHandler(function(b){return this.push(b.isError()?Q(a(b.error)):b)}))},a.prototype.mapEnd=function(){var a;return a=M(arguments),ab(this,"mapEnd",a,this.withHandler(function(b){return b.isEnd()?(this.push(Q(a(b))),this.push(z()),n.noMore):this.push(b)}))},a.prototype.doAction=function(){var a;return a=M(arguments),ab(this,"doAction",a,this.withHandler(function(b){return b.hasValue()&&a(b.value()),this.push(b)}))},a.prototype.skip=function(a){return ab(this,"skip",a,this.withHandler(function(b){return b.hasValue()?a>0?(a--,n.more):this.push(b):this.push(b)}))},a.prototype.skipDuplicates=function(a){return null==a&&(a=function(a,b){return a===b}),ab(this,"skipDuplicates",this.withStateMachine(l,function(b,c){return c.hasValue()?c.isInitial()||b===l||!a(b.get(),c.value())?[new q(c.value()),[c]]:[b,[]]:[b,[c]]}))},a.prototype.skipErrors=function(){return ab(this,"skipErrors",this.withHandler(function(a){return a.isError()?n.more:this.push(a)}))},a.prototype.withStateMachine=function(a,b){var c;return c=a,ab(this,"withStateMachine",a,b,this.withHandler(function(a){var d,e,f,g,h,i,j;for(d=b(c,a),e=d[0],g=d[1],c=e,h=n.more,i=0,j=g.length;j>i;i++)if(f=g[i],h=this.push(f),h===n.noMore)return h;return h}))},a.prototype.scan=function(a,b,c){var d,e,f,g,h;return e=W(b),b=c?e:function(a,b){return e(a(),b())},d=$(a).map(function(a){return cb.always(a)}),g=this,h=function(a){return function(c){var e,g,h,i;return e=!1,i=R,g=n.more,h=function(){return e?void 0:d.forEach(function(a){return e=!0,g=c(new j(a)),g===n.noMore?(i(),i=R):void 0})},i=a.subscribeInternal(function(a){var f,i;return a.hasValue()?e&&a.isInitial()?n.more:(a.isInitial()||h(),e=!0,i=d.getOrElse(function(){return void 0}),f=cb.cached(function(){return b(i,a.value)}),d=new q(f),c(a.apply(f))):(a.isEnd()&&(g=h()),g!==n.noMore?c(a):void 0)}),s.whenDoneWith(f,h),i}}(this),f=new o(y(this,"scan",a,b),h)},a.prototype.fold=function(a,b){return ab(this,"fold",a,b,this.scan(a,b).sampledBy(this.filter(!1).mapEnd().toProperty()))},a.prototype.zip=function(a,b){return null==b&&(b=Array),ab(this,"zip",a,n.zipWith([this,a],b))},a.prototype.diff=function(a,b){return b=W(b),ab(this,"diff",a,b,this.scan([a],function(a,c){return[c,b(a[0],c)]}).filter(function(a){return 2===a.length}).map(function(a){return a[1]}))},a.prototype.flatMap=function(){return B(this,P(arguments))},a.prototype.flatMapFirst=function(){return B(this,P(arguments),!0)},a.prototype.flatMapLatest=function(){var a,b;return a=P(arguments),b=this.toEventStream(),ab(this,"flatMapLatest",a,b.flatMap(function(){return function(c){return O(a(c)).takeUntil(b)}}(this)))},a.prototype.not=function(){return ab(this,"not",this.map(function(a){return!a}))},a.prototype.log=function(){var a;return a=1<=arguments.length?eb.call(arguments,0):[],this.subscribe(function(b){return"undefined"!=typeof console&&null!==console?"function"==typeof console.log?console.log.apply(console,eb.call(a).concat([b.toString()])):void 0:void 0}),this},a.prototype.slidingWindow=function(a,b){return null==b&&(b=0),ab(this,"slidingWindow",a,b,this.scan([],function(b,c){return b.concat([c]).slice(-a)}).filter(function(a){return a.length>=b}))},a.prototype.combine=function(a,b){var c;return c=W(b),ab(this,"combine",a,b,n.combineAsArray(this,a).map(function(a){return c(a[0],a[1])}))},a.prototype.decode=function(a){return ab(this,"decode",a,this.combine(n.combineTemplate(a),function(a,b){return b[a]}))},a.prototype.awaiting=function(a){return ab(this,"awaiting",a,n.groupSimultaneous(this,a).map(function(a){var b,c;return b=a[0],c=a[1],0===c.length}).toProperty(!1).skipDuplicates())},a.prototype.name=function(a){return this.toString=function(){return a},this},a.prototype.withDescription=function(){return y.apply(null,arguments).apply(this)},a}(),m.prototype.reduce=m.prototype.fold,B=function(a,b,d){return new i(y(a,"flatMap"+(d?"First":""),b),function(e){var f,g;return g=new c,f=function(a){return a(),g.empty()?e(z()):void 0},g.add(function(c,h){return a.subscribeInternal(function(a){var c;return a.isEnd()?f(h):a.isError()?e(a):d&&g.count()>1?n.more:g.unsubscribed?n.noMore:(c=O(b(a.value())),g.add(function(a,b){return c.subscribeInternal(function(c){var d;return c.isEnd()?(f(b),n.noMore):(c instanceof j&&(c=c.toNext()),d=e(c),d===n.noMore&&a(),d)})}))})}),g.unsubscribe})},i=function(a){function b(a,c){this.takeUntil=hb(this.takeUntil,this),this.sampledBy=hb(this.sampledBy,this);var d;H(a)&&(c=a,a=[]),b.__super__.constructor.call(this,a),d=new e(c),this.subscribeInternal=d.subscribe,this.subscribe=s.wrappedSubscribe(this),this.hasSubscribers=d.hasSubscribers,U(this)}return gb(b,a),b.prototype.delay=function(a){return ab(this,"delay",a,this.flatMap(function(b){return n.later(a,b)}))},b.prototype.debounce=function(a){return ab(this,"debounce",a,this.flatMapLatest(function(b){return n.later(a,b)}))},b.prototype.debounceImmediate=function(a){return ab(this,"debounceImmediate",a,this.flatMapFirst(function(b){return n.once(b).concat(n.later(a).filter(!1))}))},b.prototype.throttle=function(a){return ab(this,"throttle",a,this.bufferWithTime(a).map(function(a){return a[a.length-1]}))},b.prototype.bufferWithTime=function(a,b){var c,d;return c=b?0:1,d=function(a){return a.schedule()},ab(this,"bufferWithTime",a,this.buffer(a,d,d,c))},b.prototype.bufferWithCount=function(a){return ab(this,"bufferWithCount",a,this.bufferWithTimeOrCount(void 0,a))},b.prototype.bufferWithTimeOrCount=function(a,b){var c;return c=function(c){return c.values.length===b?c.flush():void 0!==a?c.schedule():void 0},ab(this,"bufferWithTimeOrCount",a,b,this.buffer(a,c,c))},b.prototype.buffer=function(a,b,c,d){var e,f,g;return null==b&&(b=function(){}),null==c&&(c=function(){}),null==d&&(d=1),e={scheduled:!1,end:null,values:[],flush:function(){var a;if(this.scheduled=!1,this.values.length>=d){if(a=this.push(Q(this.values)),this.values=[],null!=this.end)return this.push(this.end);if(a!==n.noMore)return c(this)}else if(null!=this.end)return this.push(this.end)},schedule:function(){return this.scheduled?void 0:(this.scheduled=!0,a(function(a){return function(){return a.flush()}}(this)))}},g=n.more,H(a)||(f=a,a=function(a){return n.scheduler.setTimeout(a,f)}),ab(this,"buffer",this.withHandler(function(a){return e.push=this.push,a.isError()?g=this.push(a):a.isEnd()?(e.end=a,e.scheduled||e.flush()):(e.values.push(a.value()),b(e)),g}))},b.prototype.merge=function(a){var c;return c=this,new b(y(c,"merge",a),function(b){var d,e;return d=0,e=function(a){return function(c){return a.subscribeInternal(function(a){var e;return a.isEnd()?(d++,2===d?b(z()):n.more):(e=b(a),e===n.noMore&&c(),e)})}},v(e(c),e(a))})},b.prototype.toProperty=function(a){return 0===arguments.length&&(a=l),ab(this,"toProperty",a,this.scan(a,J,!0))},b.prototype.toEventStream=function(){return this},b.prototype.sampledBy=function(a,b){return ab(this,"sampledBy",a,b,this.toProperty().sampledBy(a,b))},b.prototype.concat=function(a){var c;return c=this,new b(y(c,"concat",a),function(b){var d,e;return e=R,d=c.subscribeInternal(function(c){return c.isEnd()?e=a.subscribeInternal(b):b(c)}),function(){return d(),e()}})},b.prototype.takeUntil=function(a){var b;return b={},ab(this,"takeUntil",a,n.groupSimultaneous(this.mapEnd(b),a.skipErrors()).withHandler(function(c){var d,e,f,g,h,i;if(c.hasValue()){if(i=c.value(),d=i[0],a=i[1],a.length)return this.push(z());for(e=n.more,g=0,h=d.length;h>g;g++)f=d[g],e=this.push(f===b?z():Q(f));return e}return this.push(c)}))},b.prototype.skipUntil=function(a){var b;return b=a.take(1).map(!0).toProperty(!1),ab(this,"skipUntil",a,this.filter(b))},b.prototype.skipWhile=function(){var a,b,c;return b=arguments[0],a=2<=arguments.length?eb.call(arguments,1):[],c=!1,x(this,b,a,function(a){return ab(this,"skipWhile",a,this.withHandler(function(b){return!c&&b.hasValue()&&a(b.value())?n.more:(b.hasValue()&&(c=!0),this.push(b))}))})},b.prototype.startWith=function(a){return ab(this,"startWith",a,n.once(a).concat(this))},b.prototype.withHandler=function(a){var c;return c=new e(this.subscribeInternal,a),new b(y(this,"withHandler",a),c.subscribe)},b}(m),o=function(a){function b(a,c,d){this.toEventStream=hb(this.toEventStream,this),this.toProperty=hb(this.toProperty,this),this.changes=hb(this.changes,this),this.sample=hb(this.sample,this),H(a)&&(d=c,c=a,a=[]),b.__super__.constructor.call(this,a),this.subscribeInternal=d===!0?c:new p(this,c,d).subscribe,this.sampledBy=function(a){return function(c,d){var e,f,g,h,i;return null!=d?d=W(d):(e=!0,d=function(a){return a()}),i=new r(a,!1,!1,a.subscribeInternal,e),g=new r(c,!0,!1,c.subscribeInternal,e),h=n.when([i,g],d),f=c instanceof b?h.toProperty():h,ab(a,"sampledBy",c,d,f)}}(this),this.subscribe=s.wrappedSubscribe(this),U(this)}return gb(b,a),b.prototype.sample=function(a){return ab(this,"sample",a,this.sampledBy(n.interval(a,{})))},b.prototype.changes=function(){return new i(y(this,"changes"),function(a){return function(b){return a.subscribeInternal(function(a){return a.isInitial()?void 0:b(a)})}}(this))},b.prototype.withHandler=function(a){return new b(y(this,"withHandler",a),this.subscribeInternal,a)},b.prototype.toProperty=function(){return this},b.prototype.toEventStream=function(){return new i(y(this,"toEventStream"),function(a){return function(b){return a.subscribeInternal(function(a){return a.isInitial()&&(a=a.toNext()),b(a)})}}(this))},b.prototype.and=function(a){return ab(this,"and",a,this.combine(a,function(a,b){return a&&b}))},b.prototype.or=function(a){return ab(this,"or",a,this.combine(a,function(a,b){return a||b}))},b.prototype.delay=function(a){return this.delayChanges("delay",a,function(b){return b.delay(a)})},b.prototype.debounce=function(a){return this.delayChanges("debounce",a,function(b){return b.debounce(a)})},b.prototype.throttle=function(a){return this.delayChanges("throttle",a,function(b){return b.throttle(a)})},b.prototype.delayChanges=function(){var a,b,c;return a=2<=arguments.length?eb.call(arguments,0,c=arguments.length-1):(c=0,[]),b=arguments[c++],ab.apply(null,[this].concat(eb.call(a),[t(this,b(this.changes()))]))},b.prototype.takeUntil=function(a){var b;return b=this.changes().takeUntil(a),ab(this,"takeUntil",a,t(this,b))},b.prototype.startWith=function(a){return ab(this,"startWith",a,this.scan(a,function(a,b){return b}))},b}(m),x=function(a,b,c,d){var e;return b instanceof o?(e=b.sampledBy(a,function(a,b){return[a,b]}),d.apply(e,[function(a){var b,c;return b=a[0],c=a[1],b}]).map(function(a){var b,c;return b=a[0],c=a[1]})):(b=L(b,c),d.apply(a,[b]))},t=function(a,b){var c;return c=new i(y(a,"justInitValue"),function(b){var d,e;return e=null,d=a.subscribeInternal(function(a){return a.hasValue()&&(e=a),n.noMore}),s.whenDoneWith(c,function(){return null!=e&&b(e),b(z())}),d}),c.concat(b).toProperty()},e=function(){function a(a,b){var c,d,e,f,g,h,i,j,k,l;null==a&&(a=function(){return R}),j=[],h=null,g=!1,d=!1,this.hasSubscribers=function(){return j.length>0},e=null,k=R,i=function(a){return j=cb.without(a,j)},l=null,c=function(){var a,b,c,d,e;if(null!=l){for(b=l,l=null,e=[],c=0,d=b.length;d>c;c++)a=b[c],e.push(a());return e}},f=function(a){var b,d,f,l,m,o;if(g)return h=(h||[]).concat([a]),n.more;if(a!==e){a.isError()&&(e=a),f=!1;try{for(g=!0,l=j,m=0,o=l.length;o>m;m++)d=l[m],b=d.sink(a),(b===n.noMore||a.isEnd())&&i(d);f=!0}finally{g=!1,f||(h=null)}for(f=!0;null!=h?h.length:void 0;)a=cb.head(h),h=cb.tail(h),this.push(a);return c(a),this.hasSubscribers()?n.more:(k(),n.noMore)}},this.push=function(a){return function(b){return s.inTransaction(b,a,f,[b])}}(this),null==b&&(b=function(a){return this.push(a)}),this.handleEvent=function(a){return function(c){return c.isEnd()&&(d=!0),b.apply(a,[c])}}(this),this.subscribe=function(b){return function(c){var e,f;return d?(c(z()),R):(e={sink:c},j=j.concat(e),1===j.length&&(f=a(b.handleEvent),k=function(){return f(),k=R}),function(){return i(e),b.hasSubscribers()?void 0:k()})}}(this)}return a}(),p=function(a){function b(a,c,d){var e,f,g,h;b.__super__.constructor.call(this,c,d),e=l,f=void 0,h=this.push,c=this.subscribe,g=!1,this.push=function(a){return function(b){return b.isEnd()&&(g=!0),b.hasValue()&&(e=new q(b),f=s.currentEventId()),h.apply(a,[b])}}(this),this.subscribe=function(b){return function(d){var h,i,j,k,l;return i=!1,k=n.more,j=function(){return k===n.noMore?R:g?(d(z()),R):c.apply(this,[d])},e.isDefined&&(b.hasSubscribers()||g)?(h=s.currentEventId(),l=f,!g&&l&&h&&h!==l?(s.whenDoneWith(a,function(){return f===l?d(E(e.get().value())):void 0}),j()):(s.inTransaction(void 0,b,function(){return k=d(E(e.get().value()))},[]),j())):j()}}(this)}return gb(b,a),b}(e),b=function(a){function b(){var a,c,d,e,f,h,i,j;d=void 0,h=[],a=!1,c=function(){return function(a){return function(b){return b.isEnd()?(j(a),n.noMore):d(b)}}}(this),i=function(){var a,b,c,d;for(d=[],b=0,c=h.length;c>b;b++)a=h[b],d.push("function"==typeof a.unsub?a.unsub():void 0);return d},f=function(a){return a.unsub=a.input.subscribeInternal(c(a.input))},j=function(a){var b,c,d,e;for(b=d=0,e=h.length;e>d;b=++d)if(c=h[b],c.input===a)return"function"==typeof c.unsub&&c.unsub(),void h.splice(b,1)},e=function(){return function(a){var b,c,e,g;for(d=a,g=u(h),c=0,e=g.length;e>c;c++)b=g[c],f(b);return i}}(this),b.__super__.constructor.call(this,y(n,"Bus"),e),this.plug=function(){return function(b){var c;if(!a)return c={input:b},h.push(c),null!=d&&f(c),function(){return j(b)}}}(this),this.push=function(){return function(a){return"function"==typeof d?d(Q(a)):void 0}}(this),this.error=function(){return function(a){return"function"==typeof d?d(new g(a)):void 0}}(this),this.end=function(){return function(){return a=!0,i(),"function"==typeof d?d(z()):void 0}}(this)}return gb(b,a),b}(i),r=function(){function a(a,b,c,d,e,f){var g;this.obs=a,this.sync=b,this.subscribe=d,null==e&&(e=!1),null==f&&(f=[]),g=e?cb.id:function(a){return a()},null==this.subscribe&&(this.subscribe=a.subscribeInternal),this.markEnded=function(){return this.ended=!0},this.toString=this.obs.toString,c?(this.consume=function(){return g(f.shift())},this.push=function(a){return f.push(a)},this.mayHave=function(a){return!this.ended||f.length>=a},this.hasAtLeast=function(a){return f.length>=a},this.flatten=!1):(this.consume=function(){return g(f[0])},this.push=function(a){return f=[a]},this.mayHave=function(){return!0},this.hasAtLeast=function(){return f.length},this.flatten=!0)}return a}(),a=function(a){function b(a){var c;this.obs=a,c=[],b.__super__.constructor.call(this,this.obs,!0,!1,this.obs.subscribeInternal,!1,c),this.consume=function(){var a;return a=c,c=[],a},this.push=function(a){return c.push(a())},this.hasAtLeast=function(){return!0}}return gb(b,a),b}(r),r.fromObservable=function(a){return a instanceof r?a:a instanceof o?new r(a,!1,!1):new r(a,!0,!0)},y=function(){var a,b,c;return b=arguments[0],c=arguments[1],a=3<=arguments.length?eb.call(arguments,2):[],(b||c)instanceof d?b||c:new d(b,c,a)},d=function(){function a(a,b,c){var d,e,f,g;f=function(a){return F(a)?cb.flatMap(f,a):I(a)?[a]:a instanceof r?[a.obs]:[]},g=null,d=function(a){var b,c,e,f,h;for(c=a.internalDeps(),h=[],e=0,f=c.length;f>e;e++)b=c[e],g[b.id]=!0,h.push(d(b));return h},e=function(a){return null==g&&(g={},d(this)),g[a.id]},this.apply=function(d){var g;return g=cb.cached(function(){return f([a].concat(c))}),d.internalDeps=d.internalDeps||g,d.dependsOn=e,d.deps=g,d.toString=function(){return cb.toString(a)+"."+cb.toString(b)+"("+cb.map(cb.toString,c)+")"},d.inspect=function(){return d.toString()},d.desc=function(){return{context:a,method:b,args:c}},d}}return a}(),ab=function(){var a,b,c;return a=2<=arguments.length?eb.call(arguments,0,c=arguments.length-1):(c=0,[]),b=arguments[c++],y.apply(null,a).apply(b)},n.when=function(){var a,b,c,d,e,f,g,h,j,k,l,m,o,p,q,t,u,x,A;if(k=1<=arguments.length?eb.call(arguments,0):[],0===k.length)return n.never();for(e=k.length,p="when: expecting arguments in the form (Observable+,function)+",o=[],j=[],b=0;e>b;){for(h=cb.toArray(k[b]),a=k[b+1],g={f:H(a)?a:function(){return a},ixs:[]},q=0,u=h.length;u>q;q++){for(m=h[q],c=cb.indexOf(o,m),0>c&&(o.push(m),c=o.length-1),A=g.ixs,t=0,x=A.length;x>t;t++)d=A[t],d.index===c&&d.count++;g.ixs.push({index:c,count:1})}h.length>0&&j.push(g),b+=2}return o.length?(o=cb.map(r.fromObservable,o),f=cb.any(o,function(a){return a.flatten})&&w(cb.map(function(a){return a.obs},o)),l=new i(y.apply(null,[n,"when"].concat(eb.call(k))),function(a){var c,d,e,g,h,i,k;return k=[],e=!1,g=function(a){var c,d,e;for(e=a.ixs,c=0,d=e.length;d>c;c++)if(b=e[c],!o[b.index].hasAtLeast(b.count))return!1;return!0},d=function(a){return!a.sync||a.ended},c=function(a){var c,d,e;for(e=a.ixs,c=0,d=e.length;d>c;c++)if(b=e[c],!o[b.index].mayHave(b.count))return!0},h=function(a){return!a.source.flatten},i=function(i){return function(m){var p,q,r;return q=function(){return s.whenDoneWith(l,p)},r=function(){var c,d,e,i,l,m;if(!(k.length>0))return n.more;for(d=n.more,e=k.pop(),l=0,m=j.length;m>l;l++)if(c=j[l],g(c))return i=function(){return c.f.apply(c,function(){var a,d,e,f;for(e=c.ixs,f=[],a=0,d=e.length;d>a;a++)b=e[a],f.push(o[b.index].consume());return f}())},d=a(e.e.apply(i)),k.length&&f&&(k=cb.filter(h,k)),d===n.noMore?d:r()},p=function(){var b;return b=r(),e&&(e=!1,(cb.all(o,d)||cb.all(j,c))&&(b=n.noMore,a(z()))),b===n.noMore&&m(),b},i.subscribe(function(b){var c;return b.isEnd()?(e=!0,i.markEnded(),q()):b.isError()?c=a(b):(i.push(b.value),i.sync&&(k.push({source:i,e:b}),f?q():p())),c===n.noMore&&m(),c||n.more})}},v.apply(null,function(){var a,b,c;for(c=[],a=0,b=o.length;b>a;a++)m=o[a],c.push(i(m));return c}())})):n.never()},w=function(a,b){var c;return null==b&&(b=[]),c=function(a){var d;return n._.contains(b,a)?!0:(d=a.internalDeps(),d.length?(b.push(a),n._.any(d,c)):(b.push(a),!1))},n._.any(a,c)},n.update=function(){var a,b,c,d;for(b=arguments[0],d=2<=arguments.length?eb.call(arguments,1):[],c=function(a){return function(){var b;return b=1<=arguments.length?eb.call(arguments,0):[],function(c){return a.apply(null,[c].concat(b))}}},a=d.length-1;a>0;)d[a]instanceof Function||(d[a]=function(a){return function(){return a}}(d[a])),d[a]=c(d[a]),a-=2;return ab.apply(null,[n,"update",b].concat(eb.call(d),[n.when.apply(n,d).scan(b,function(a,b){return b(a)})]))},v=function(){var a;return a=1<=arguments.length?eb.call(arguments,0):[],new c(a).unsubscribe},c=function(){function a(a){var b,c,d;for(null==a&&(a=[]),this.empty=hb(this.empty,this),this.count=hb(this.count,this),this.unsubscribe=hb(this.unsubscribe,this),this.add=hb(this.add,this),this.unsubscribed=!1,this.subscriptions=[],this.starting=[],c=0,d=a.length;d>c;c++)b=a[c],this.add(b)}return a.prototype.add=function(a){var b,c,d;if(!this.unsubscribed)return b=!1,c=R,this.starting.push(a),d=function(d){return function(){return d.unsubscribed?void 0:(b=!0,d.remove(c),cb.remove(a,d.starting))}}(this),c=a(this.unsubscribe,d),this.unsubscribed||b||this.subscriptions.push(c),cb.remove(a,this.starting),c},a.prototype.remove=function(a){return this.unsubscribed?void 0:void 0!==cb.remove(a,this.subscriptions)?a():void 0},a.prototype.unsubscribe=function(){var a,b,c,d;if(!this.unsubscribed){for(this.unsubscribed=!0,d=this.subscriptions,b=0,c=d.length;c>b;b++)(a=d[b])();return this.subscriptions=[],this.starting=[]}},a.prototype.count=function(){return this.unsubscribed?0:this.subscriptions.length+this.starting.length},a.prototype.empty=function(){return 0===this.count()},a}(),n.CompositeUnsubscribe=c,q=function(){function a(a){this.value=a}return a.prototype.getOrElse=function(){return this.value},a.prototype.get=function(){return this.value},a.prototype.filter=function(b){return b(this.value)?new a(this.value):l},a.prototype.map=function(b){return new a(b(this.value))},a.prototype.forEach=function(a){return a(this.value)},a.prototype.isDefined=!0,a.prototype.toArray=function(){return[this.value]},a.prototype.inspect=function(){return"Some("+this.value+")"},a.prototype.toString=function(){return this.inspect()},a}(),l={getOrElse:function(a){return a},filter:function(){return l},map:function(){return l},forEach:function(){},isDefined:!1,toArray:function(){return[]},inspect:function(){return"None"},toString:function(){return this.inspect()}},s=function(){var a,b,c,d,e,f,g,h,i,j,k;return h=void 0,i=[],b=[],a=function(a){return h?b.push(a):a()},g=function(a){return!cb.any(i,function(b){return a.obs.dependsOn(b.obs)})},j=function(a,b){return h?i.push({obs:a,f:b}):b()},d=function(){for(;!g(i[0]);)i.push(i.splice(0,1)[0]);return i.splice(0,1)[0]},e=function(){var a;for(a=[];i.length;)a.push(d().f());return a},f=function(a,c,d,f){var g;if(h)return d.apply(c,f);h=a;try{g=d.apply(c,f),e()}finally{for(h=void 0;b.length;)(d=b.splice(0,1)[0])()}return g},c=function(){return h?h.id:void 0},k=function(b){return function(c){var d,e,f;return f=!1,d=function(){},e=function(){return f=!0,d()},f||(d=b.subscribeInternal(function(b){return a(function(){var a;return f||(a=c(b),a!==n.noMore)?void 0:e()})})),e}},{whenDoneWith:j,inTransaction:f,currentEventId:c,wrappedSubscribe:k}}(),n.EventStream=i,n.Property=o,n.Observable=m,n.Bus=b,n.Initial=j,n.Next=k,n.End=f,n.Error=g,R=function(){},J=function(a,b){return b()},C=function(a){return a},E=function(a){return new j(cb.always(a))},Q=function(a){return new k(cb.always(a))},z=function(){return new f},X=function(a){return a instanceof h?a:Q(a)},u=function(a){return a.slice(0)},H=function(a){return"function"==typeof a},F=function(a){return a instanceof Array},I=function(a){return a instanceof m},S=function(a,b){return function(){var c;
return c=1<=arguments.length?eb.call(arguments,0):[],a.apply(null,b.concat(c))}},P=function(a){return 1===a.length&&I(a[0])?cb.always(a[0]):M(a)},M=function(a){return a=Array.prototype.slice.call(a),N.apply(null,a)},N=bb(function(){var a,b;return b=arguments[0],a=2<=arguments.length?eb.call(arguments,1):[],H(b)?a.length?S(b,a):b:G(b)?Y(b,a):cb.always(b)}),L=function(a,b){return N.apply(null,[a].concat(eb.call(b)))},O=function(a){return I(a)?a:n.once(a)},G=function(a){return"string"==typeof a&&a.length>1&&"."===a.charAt(0)},n.isFieldKey=G,Y=function(a,b){var c,d;return d=a.slice(1).split("."),c=cb.map(_(b),d),function(b){var d,e;for(d=0,e=c.length;e>d;d++)a=c[d],b=a(b);return b}},_=function(a){return function(b){return function(c){var d;return null==c?void 0:(d=c[b],H(d)?d.apply(c,a):d)}}},Z=function(a){return a.slice(1)},W=function(a){var b;return H(a)?a:G(a)?(b=Z(a),function(a,c){return a[b](c)}):void 0},$=function(a){return a instanceof q||a===l?a:new q(a)},cb={indexOf:Array.prototype.indexOf?function(a,b){return a.indexOf(b)}:function(a,b){var c,d,e,f;for(c=e=0,f=a.length;f>e;c=++e)if(d=a[c],b===d)return c;return-1},indexWhere:function(a,b){var c,d,e,f;for(c=e=0,f=a.length;f>e;c=++e)if(d=a[c],b(d))return c;return-1},head:function(a){return a[0]},always:function(a){return function(){return a}},negate:function(a){return function(b){return!a(b)}},empty:function(a){return 0===a.length},tail:function(a){return a.slice(1,a.length)},filter:function(a,b){var c,d,e,f;for(c=[],e=0,f=b.length;f>e;e++)d=b[e],a(d)&&c.push(d);return c},map:function(a,b){var c,d,e,f;for(f=[],d=0,e=b.length;e>d;d++)c=b[d],f.push(a(c));return f},each:function(a,b){var c,d,e;e=[];for(c in a)d=a[c],e.push(b(c,d));return e},toArray:function(a){return F(a)?a:[a]},contains:function(a,b){return-1!==cb.indexOf(a,b)},id:function(a){return a},last:function(a){return a[a.length-1]},all:function(a,b){var c,d,e;for(null==b&&(b=cb.id),d=0,e=a.length;e>d;d++)if(c=a[d],!b(c))return!1;return!0},any:function(a,b){var c,d,e;for(null==b&&(b=cb.id),d=0,e=a.length;e>d;d++)if(c=a[d],b(c))return!0;return!1},without:function(a,b){return cb.filter(function(b){return b!==a},b)},remove:function(a,b){var c;return c=cb.indexOf(b,a),c>=0?b.splice(c,1):void 0},fold:function(a,b,c){var d,e,f;for(e=0,f=a.length;f>e;e++)d=a[e],b=c(b,d);return b},flatMap:function(a,b){return cb.fold(b,[],function(b,c){return b.concat(a(c))})},cached:function(a){var b;return b=l,function(){return b===l&&(b=a(),a=null),b}},toString:function(a){var b,c,d,e;try{return T++,null==a?"undefined":H(a)?"function":F(a)?T>5?"[..]":"["+cb.map(cb.toString,a).toString()+"]":null!=(null!=a?a.toString:void 0)&&a.toString!==Object.prototype.toString?a.toString():"object"==typeof a?T>5?"{..}":(c=function(){var c;c=[];for(d in a)fb.call(a,d)&&(e=function(){try{return a[d]}catch(c){return b=c}}(),c.push(cb.toString(d)+":"+cb.toString(e)));return c}(),"{"+c+"}"):a}finally{T--}}},T=0,n._=cb,n.scheduler={setTimeout:function(a,b){return setTimeout(a,b)},setInterval:function(a,b){return setInterval(a,b)},clearInterval:function(a){return clearInterval(a)},now:function(){return(new Date).getTime()}},"undefined"!=typeof module&&null!==module?(module.exports=n,n.Ponyfood=n):("undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return n}),this.Ponyfood=n)}).call(this);
